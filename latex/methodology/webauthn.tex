We used WebAuthn to perform passwordless authentication in LessPM\@.
WebAuthn is a collaborative open standard between the FIDO Alliance and W3C\@.
The aim of the standard is to implement a secure, robust key-based
authentication system for the web, to strongly authenticate users through
biometrics~\cite{webauthn_level_2}.
The concept relies on the use of a third-party device, called an
Authenticator Device (AD), which leverages asymmetric cryptography.
These devices employ biometric or hardware-based mechanism to provide secure
and reliable means of authenticating a user in LessPM\@.

Upon registering in LessPM, the AD generated a key-pair called a Passkey.
This Passkey contained a CID uniquely generated for each registered
key-pair~\cite{webauthn_credential_id,webauthn_public_key_credential}, per
services registered on the AD\@.

Further, if a malefactor gains access to an individual's Passkey, they might
compromise one specific service, whereas a traditional password could
potentially compromise multiple services where password reuse
occurs~\cite{wang2018next}.
This suggests that WebAuthn could create a stronger level of security, whereas
a traditional password exposed in a leak might leave a user susceptible to
losing access across services and devices through the reused password.
Preventing the potential security threat of password reuse is a top priority
for LessPM\@.
That is why WebAuthn has been chosen as the preferred standard for
passwordless user authentication in LessPM\@.

WebAuthn further attempts to mitigate phishing, man-in-the-middle, and
brute-force attacks through its intuitive design~\cite{webauthn_level_2}.
By leveraging the increasing market of smartphones with
biometrics~\cite{statista-biometric-transactions}, WebAuthn becomes a natural
extension, not just for LessPM, but for general authentication.

In order to increase the security of authenticated requests, each of the
steps, Registration~\ref{subsubsec:metho-registration},
Authentication~\ref{subsubsec:metho-authentication} and
Password- Creation \& Retrieval~\ref{subsubsec:creation-and-retrieval})
in WebAuthn receives different tokens with different information and is
constructed, verified, and discarded separately.\footnote{
  The token for password creation/retrieval is the same as verifying that a user
  is signed in and authorized to create entries on behalf of the user.
}
We made this decision to further elevate security in LessPM, so that an
exposed token could not serve as more than one entry point for one of the steps.

\subsubsection{Registration}\label{subsubsec:metho-registration}
When a user tried registering in LessPM, the client performs a
registration request to the server, called a Relying Party (RP), carrying a
relevant User Identifier (UID. i.e.\ username, phone number, email, Etc.).
This is done to check whether a user with a similar UID existed\footnote{
  WebAuthn does not require to check whether the CID generated by the AD exists.
  However, accepting users with similar identifier might leave a risk of
  providing unauthorized access.
  Hence why LessPM performs such a check.
} in the system, and LessPM denies the registration process if it does.

If there are no users with a similar UID, LessPM responds by initiating a
Registration Ceremony (RC), generated a challenge and a Unique User
Identifier (UUID) version 4, which serves as the body of the HTTPS response.
LessPM also attached a JWE to the HTTPS response header's
\texttt{Authorization} which is sent to the client.

The \texttt{expiration} time for this claim is set to one minute to allow the
user some time to authenticate.\footnote{
  WebAuthn describes a timeout performed within the system. In our case, this
  timeout is one minute.
  However, we chose to add this extra step to secure LessPM further, and
  JWEs require an expiry time (See Section~\ref{subsec:auth-and-auth}).
}
The claim expired after this minute, and the user would then have to restart the
process.
This expiration timer was a decision we made to emphasize security within LessPM
further.

Using the issued challenge, LessPM's client called the browser-integrated
WebAuthn Application Programming Interface (API)\footnote{
  In LessPM's case, this is the \textit{navigator.credentials} API provided by
  the browser.
},
prompting the user to utilize their AD to create a new Passkey credential
through the Client To Authenticator Protocol (CTAP2)\footnote{
  The user is prompted to use their AD to prove their presence, which can
  involve facial recognition, providing a fingerprint, or any other modality
  supported by the device that the user chooses.
} for
LessPM\@.
At this point, it is entirely up to the user to decide what device to use to
authenticate.
For our development, we used an Apple iPhone 13 Pro Max, a Samsung S21, and a
Samsung Galaxy A52 to test authentication.\footnote{
  Other alternatives included a YubiKey, NitroKey, Etc.
}
We scanned the QR codes prompted through our phones, which initiated the
key-pair generation on the AD after a successful biometric scan, such as
facial recognition.\footnote{
  There is a question of concern that photography can bypass facial recognition.
  Apple uses built-in sensors to scan depth, colours and a dot projector to
  create a 3D scan of a person's face.
  However, this approach prevents the use of photography to authenticate through
  their FaceID and TrueDepth technology~\cite{apple-support}.
}

Finally, the AD signs the challenge using the private key stored on the
device.
The created public key, signed challenge, and additional metadata are combined
into a public key credential object, which is forwarded to the client
through CTAP2 and then sent to LessPM in a new request.
Before the new request reaches the RP/LessPM, an authentication middleware
checks for the JWE and denies the request with an \texttt{Unauthorized} HTTPS
status code if the request is invalid.\footnote{
  Validity in this context means not timed out, tampered with, or similar.
}
If the RP/LessPM can validate the authenticity of the signed challenge and
public key through WebAuthn, the user was stored in the database, along with the
UUID generated.
Thus completing the RC\@.
\todo[inline]{
  This process can be sign in figure huhu.
}

\subsubsection{Authentication}\label{subsubsec:metho-authentication}
When a user wishes to perform authentication (commonly referred to as
\texttt{logging in}), much of the same procedure occurs.
The user issued an authentication request in the LessPM's client, carrying
the UID the user used to register.
The client included this information in the body.
Upon receiving an incoming request, the RP/LessPM checked the database for
the containing UID\@.
LessPM immediately rejected the request, should the user not exist in the
database.
If LessPM found an associated user with the UID in the database, the server
responds by initiating and issuing an Authentication Ceremony (AC),
collecting the public key associated with the user from the database and
generating a new challenge.
Upon validation\footnote{
  Validation in this context only means that the key stored in the database
  is valid.
} of the public key, LessPM creates a new JWE, which, like registration, also
receives an \texttt{expiry} time of one minute for the user to authenticate,
attached to the HTTPS \texttt{Authorization} header.
The challenge is issued and LessPM's client then calls the
browser-integrated WebAuthn API again, prompting the use of the original AD
to validate and sign the challenge through CTAP2.
Unlike the registration process, the AD now yields a signed signature based
on the challenge issued by the RP/LessPM\@, which is transferred back to
LessPM's client through CTAP2 with some AD specific
data~\cite{webauthn_authenticator_data}.
A new HTTPS request is then issued with the signed challenge and AD specific
data and the RP/LessPM then validated the signature using the stored public
key.
LessPM considers the user authenticated if the RP accepted and validated the
signed challenge.
If the AC is unsuccessful at any point in the ceremony, the ceremony is
aborted and considered invalid.

Upon success a new JWE is generated.
This time, the \texttt{expiry} time is set to a 15-minute\footnote{
  The specification does not specify any upper- or lower bounds for the
  expiry time~\cite{RFC7519}
} timeframe, allowing the user some time to perform necessary activities
within LessPM\@.
\todo[inline]{
  This process can be seen in figure HUHUHUH.
}

\subsubsection{Password Creation \& Retrieval}\label{subsubsec:creation-and-retrieval}
Passwords are sensitive in nature, so it seems only natural in a security
context to enforce an extra level of authentication upon retrieving and creating
one unique password in LessPM.\footnote{
  We retrieved a complete list of the user's passwords upon successful authentication.
  The hashed version of the password is stripped of the returned values to protect and enforce security.
}

The following options are presented to a user when they initiate a password
creation process in LessPM:

\begin{itemize}
  \item \textbf{User Identifier}: An identification that the user wants to
  associate with the password entry they are storing.
  Such as a username, phone number, or email.
  \item \textbf{Website}: A URL or similar where the password belongs.
  \item \textbf{Password}: The user is prompted with the input to create a
  strong password automatically, choosing options such as numbers, special
  symbols, smaller or larger characters, and the length.
  As an option, the user was also permitted to construct their password but
  warned by a warning saying that this option is less secure.
\end{itemize}

As a final step before a password is created and stored, the user is prompted to
reauthenticate with their AD\@.
This is done in a similar manner as described for registration (See
Section~\ref{subsubsec:metho-registration}) and authentication (See
Section~\ref{subsubsec:metho-authentication}).

To retrieve the plaintext version of the password, LessPM enforces a new
authentication request through the AD\@.
We made this decision to attempt to ensure the owner\footnote{
  In this context, we distinguish between \texttt{user} and \texttt{owner}
  as the person that created the password, not the person currently using
  LessPM.
} of
the password's presence\footnote{
  This approach is also used in password managers on phones to avoid situations
  where a user might have left their computer unlocked.
}.
In such a scenario where the owner left their computer open while logged in to
LessPM, a malefactor would not be able to simply retrieve a password at will.
To decrypt a password, LessPM also required the CID from the AD to perform
the key-reconstruction for the encryption algorithm employed in LessPM\@.
Further details about how encryption is achieved can be seen in
Section~\ref{subsec:password-encryption}.